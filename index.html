<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; }
        #globeViz { width: 100vw; height: 100vh; }
    </style>
    <script src="https://unpkg.com/three@0.173.0/build/three.min.js"></script>
    <script src="https://unpkg.com/globe.gl@2.32.0/dist/globe.gl.min.js"></script>
</head>
<body>
    <div id="globeViz"></div>

    <script>
        const globe = Globe()
            .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-dark.jpg')
            .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
            .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
            .width(window.innerWidth)
            .height(window.innerHeight);

        globe(document.getElementById('globeViz'));

        fetch('./subseaPipelines.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const pipelinePaths = data.map(pipeline => ({
                    coords: [
                        [pipeline.start_coordinates.coordinates.longitude, pipeline.start_coordinates.coordinates.latitude],
                        [pipeline.end_coordinates.coordinates.longitude, pipeline.end_coordinates.coordinates.latitude]
                    ],
                    properties: {
                        name: pipeline.name,
                        color: pipeline.health === "Degraded" ? "#ff0000" : "#00ff00"
                    }
                }));

                globe
                    .pathsData(pipelinePaths)
                    .pathPoints('coords')
                    .pathPointLat(p => p[1])
                    .pathPointLng(p => p[0])
                    .pathColor(path => path.properties.color)
                    .pathLabel(path => path.properties.name)
                    .pathDashLength(0.1)
                    .pathDashGap(0.008)
                    .pathDashAnimateTime(12000);
            })
            .catch(error => console.error('Error loading pipeline data:', error));
    </script>
</body>
</html>
